subjects$ADOS.SITotal <- ifelse(subjects$useADOS.2, subjects$ADOS2_SocialInteraction_ComparableToADOS, subjects$ADOS_Social_Interaction_Total)
subjects$ADOS.CTotal <- ifelse(subjects$useADOS.2, subjects$ADOS2_Communication_Total_ComparableToADOS, subjects$ADOS_Communication_Total)
subjects$ADOS.SCTotal <- subjects$ADOS.SITotal + subjects$ADOS.CTotal
names(subjects)
vars2keep <- c("ID", "Gender.x", "Primary_Dx", "Edinburgh_Integer_Handedness", "GAI", "AgeAtScan", "Race", "mean.FD", "max.FD", "useWISC.5")
col2keep <- match(vars2keep, names(subjects))
asdVarNames <- c("ID", "ADHD_Subtype", "SRS.Total.Raw.Score", "ADOS.Total", "ADOS.RBB", "ADOS.SITotal", "ADOS.CTotal", "ADOS.SCTotal", "ADI.A.Total..Reciprocal.Social.Interaction", "ADI.B.Verbal.Total..Communication", "ADI.C.Total..Restricted.Repetitive.Stereotyped.Behavior", "useADOS.2", "Praxis_GTI_%_Correct", "Praxis_Total_Percent_Correct")
asdCol <- match(asdVarNames, names(subjects))
sesVarNames <- c("ID","SES")
sesCol <- match(sesVarNames, names(subjects))
lessinfo <- subjects[, col2keep]
summary(lessinfo)
asdInfo <- subjects[, asdCol]
sesInfo <- subjects[, sesCol]
noMissing <- filter(lessinfo, GAI !="NA"& Primary_Dx !="ADHD" & Edinburgh_Integer_Handedness !="NA")
levels(noMissing$Primary_Dx) = c("Autism", "None")
noMissing$treat <- ifelse(noMissing$Primary_Dx=="Autism", 1, 0)
summary(noMissing)
m.out <- matchit(treat ~ mean.FD + AgeAtScan  + GAI + Gender.x + Edinburgh_Integer_Handedness, data = noMissing, method = "nearest")
plot(m.out, type = "jitter")
plot(m.out, type = "hist")
matched <- match.data(m.out)
matchedSES <- merge(matched, sesInfo, "ID")
with(matchedSES, table(Primary_Dx, Handedness))
chisq.test(matchedSES$Primary_Dx, matchedSES$Handedness)
with(matchedSES, table(Primary_Dx, Gender))
chisq.test(matchedSES$Primary_Dx, matchedSES$Gender)
with(matchedSES, table(Primary_Dx, Race))
with(matchedSES, table(Primary_Dx, Receiving.Coil))
chisq.test(matchedSES$Primary_Dx, matchedSES$Receiving.Coil)
prop.test(x=c(13, 16), n=c(81, 81), alternative = "two.sided")
tapply(matchedSES$AgeAtScan, list(matchedSES$Primary_Dx, matchedSES$Gender), median)
tapply(matchedSES$AgeAtScan, list(matchedSES$Primary_Dx), mean)
tapply(matchedSES$AgeAtScan, list(matchedSES$Primary_Dx), sd)
t.test(AgeAtScan~Primary_Dx, data = matchedSES)
#t.test(ISD~Primary.Dx, data = matchedSES)
tapply(matchedSES$GAI, list(matchedSES$Primary_Dx, matchedSES$Gender), median)
tapply(matchedSES$GAI, list(matchedSES$Primary_Dx), mean)
tapply(matchedSES$GAI, list(matchedSES$Primary_Dx), sd)
tapply(matchedSES$GAI, list(matchedSES$Primary_Dx), min)
t.test(GAI~Primary.Dx, data = matchedSES)
tapply(matchedSES$mean.FD, list(matchedSES$Primary_Dx, matchedSES$Gender), median)
tapply(matchedSES$max.FD, list(matchedSES$Primary_Dx, matchedSES$Gender), median)
tapply(matchedSES$frames, list(matchedSES$Primary_Dx, matchedSES$Gender), median)
t.test(mean.FD~Primary_Dx, data = matchedSES)
tapply(matchedSES$mean.FD, list(matchedSES$Primary_Dx), sd)
t.test(SES.Family~Primary_Dx, data = matchedSES)
tapply(matchedSES$SES.Family, list(matchedSES$Primary.Dx), sd, na.rm = TRUE)
rm(list=ls())
library("Amelia")
library("MatchIt")
library("Zelig")
library("dplyr")
library("ggplot2")
library("RColorBrewer")
library("xlsx")
library("optmatch")
library("reshape2")
library("readxl")
#Note GAI for 1560 should be 127 according to note in database
subjects <- read_excel("/home/niharika-shimona/Documents/Projects/Autism_Network/Data/forShimona_demographics_20161026.xlsx",sheet ="Query1")
motion <- read.table("/home/niharika-shimona/Documents/Projects/Autism_Network/Data/ASD_TD_DOS_289Total_motion.csv",header = TRUE, sep = ",")
WISC_params = read.table("/home/niharika-shimona/Documents/Projects/Autism_Network/Data/qry Shimona_03272017.csv",header = TRUE, sep = ",")
adi_info =read.table("/home/niharika-shimona/Documents/Projects/Autism_Network/Data/qry ShimonaADI_03292017.csv",header = TRUE, sep = ",")
#subjects <- merge(subjects, merge(motion, norm, "ID"), "ID")
subjects <- merge(subjects, motion, "ID")
subjects <- merge(subjects,WISC_params,"ID")
subjects <- merge(subjects,adi_info,"ID")
subjects <- filter(subjects, Eligibility.x == "Eligible")
subjects <- filter(subjects, ID == "408" || "435")
subjects <- filter(subjects, ID == "468" || "490")
subjects <- filter(subjects, ID ==  "825" || "947")
subjects <- filter(subjects, ID ==  "1039" || "1092")
subjects <- filter(subjects, ID ==  "825" || "947")
subjects <- filter(subjects, ID ==  "1205" || "1244")
subjects <- filter(subjects, ID ==  "1386" || "1548")
subjects <- filter(subjects, ID ==  "1556" || "1571")
subjects <- filter(subjects, ID ==  "1572" || "1602")
subjects <- filter(subjects, ID ==  "1626" || "1872")
#convert DOS numeric YYYYMMDD to character then to new Date class variable called ScanDate
subjects$DOS <- as.character(subjects$DOS)
subjects$ScanDate <- as.Date(subjects$DOS, "%Y%m%d")
str(subjects$ScanDate)
#convert factor DOB mm/dd/yyyy to new Date class variable called Bday
subjects$Bday <- as.Date(subjects$DOB, "%m/%d/%Y")
subjects$Bday[match("1980", subjects$ID)]<-c("2003-11-05")
subjects$Bday[match("1490", subjects$ID)]<-c("2005-03-26")
subjects$Bday[match("1435", subjects$ID)]<-c("2003-06-08")
subjects$Bday[match("1426", subjects$ID)]<-c("2003-07-02")
subjects$Bday[match("473", subjects$ID)]<-c("2002-08-14")
str(subjects$Bday)
#calculate AgeAtScan from ScanDate and Bday
subjects$AgeAtScan <- (subjects$ScanDate - subjects$Bday)
str(subjects$AgeAtScan)
#convert AgeAtScan from days to ~years
subjects$AgeAtScan <- as.numeric(subjects$AgeAtScan)/365
str(subjects$AgeAtScan)
#when WISC-IV completed at CARD, substitute Comprehension subtest scaled score for Info Scaled Score
#from paper scoring sheet or sometimes in Notes associated with WISC
subjects$WISC4.Info.Scaled[match("1495", subjects$ID)]<-10
subjects$WISC4.Info.Scaled[match("1496", subjects$ID)]<-11
subjects$WISC4.Info.Scaled[match("1519", subjects$ID)]<-9
#calculate sum of scaled scores that contribute to General Ability Index for subjects with WISC-IV data
GAI4colNames <- c("WISC4.Vocab.Scaled", "WISC4.Info.Scaled", "WISC4.Sim.Scaled", "WISC4.Blk.Dsn.Scaled", "WISC4.Pic.Con.Scaled", "WISC4.Matrix.Scaled")
GAI4cols <- match(GAI4colNames, names(subjects))
WISC4Melt <- melt(subjects[, c(1, GAI4cols)], id.vars=names(subjects)[1])
WISC4.ScaledSum <- summarise(group_by(WISC4Melt, ID), WISC4.ScaledSum = sum(value))
str(WISC4.ScaledSum)
WISC4.ScaledSum$WISC4.ScaledSum <- as.character(WISC4.ScaledSum$WISC4.ScaledSum)
#use wisc4GAI_lookup to convert sum of WISC-IV scaled scores to WISC-IV GAI
lookupGAI4 <- read.csv("/home/niharika-shimona/Documents/Projects/Autism_Network/Data/wisc4GAI_lookup.csv", header = TRUE, stringsAsFactors = FALSE)
WISC4.ScaledSum <- merge(WISC4.ScaledSum, lookupGAI4, "WISC4.ScaledSum")
#add WISC4.GAI to subjects data frame
subjects <- merge(subjects, WISC4.ScaledSum, "ID")
names(subjects)
#calculate sum of scaled scores that contribute to General Ability Index for subjects with WISC-V data
GAI5colNames <- c("WISC5.Blk.Dsn.Scaled", "WISC5.Sim.Scaled", "WISC5.Matrix.Scaled", "WISC5.Vocab.Scaled", "WISC5.Fig.Weigh.Scaled")
GAI5cols <- match(GAI5colNames, names(subjects))
WISC5Melt <- melt(subjects[, c(1, GAI5cols)], id.vars=names(subjects)[1])
WISC5.ScaledSum <- summarise(group_by(WISC5Melt, ID), WISC5.ScaledSum = sum(value))
str(WISC5.ScaledSum)
WISC5.ScaledSum$WISC5.ScaledSum <- as.character(WISC5.ScaledSum$WISC5.ScaledSum)
#use wisc5GAI_lookup to convert sum of WISC-5 scaled scores to WISC-5 GAI
lookupGAI5 <- read.csv("/home/niharika-shimona/Documents/Projects/Autism_Network/Data/wisc5GAI_lookup.csv", header = TRUE, stringsAsFactors = FALSE)
WISC5.ScaledSum <- merge(WISC5.ScaledSum, lookupGAI5, "WISC5.ScaledSum")
#add WISC5.GAI to subjects data frame
subjects <- merge(subjects, WISC5.ScaledSum, "ID")
names(subjects)
#only use WISC.5 if WISC.4 doesn't exist
#if have both, WISC.5 was collected at adolescent follow-up
subjects$useWISC.5 <- ifelse(is.na(subjects$WISC4.GAI), 1, 0)
subjects$GAI <- ifelse(subjects$useWISC.5==1, subjects$WISC5.GAI, subjects$WISC4.GAI)
subjects$DOE.GAI <- ifelse(subjects$useWISC.5==0, subjects$DOE.WISC.4, subjects$DOE.WISC.5)
##exclude subjects with GAI < 80
#subjects <- filter(subjects, GAI >=80)
#only use SRS-2 if SRS doesn't exist
#if have both, SRS-2 was collected at adolescent follow-up
subjects$useSRS.2 <- ifelse(is.na(subjects$bytSrsP2SocTotSrsRaw), 1, 0)
subjects$SRS.Total.Raw.Score <- ifelse(subjects$useSRS.2==0, subjects$bytSrsPSocTotSrsRaw, subjects$bytSrsP2SocTotSrsRaw)
subjects$SRS.SocAwar.Raw.Score <- ifelse(subjects$useSRS.2==0, subjects$bytSrsPSocAwarRaw, subjects$bytSrsP2SocAwarRaw)
subjects$SRS.SocCog.Raw.Score <- ifelse(subjects$useSRS.2==0, subjects$bytSrsPSocCogRaw, subjects$bytSrsP2SocCogRaw)
subjects$SRS.SocComm.Raw.Score <- ifelse(subjects$useSRS.2==0, subjects$bytSrsPSocCommRaw, subjects$bytSrsP2SocCommRaw)
subjects$SRS.SocMot.Raw.Score <- ifelse(subjects$useSRS.2==0, subjects$bytSrsPSocMotRaw, subjects$bytSrsP2SocMotRaw)
subjects$SRS.SocAutMan.Raw.Score <- subjects$bytSrsPSocAutManRaw
subjects$SRS.SocSRBI.Score <- subjects$bytSrsP2SocRestricInterRepetBehavRaw
subjects$SRS.CommInter.Score <- subjects$bytSrsP2SocCommInteractionRaw
subjects$DOE.SRS <- ifelse(subjects$useSRS.2==0, subjects$dtmDOEofSRS, subjects$dtmDOEofSrsP2)
names(subjects) <- gsub(" ","_",names(subjects))
names(subjects) <- gsub("&","and",names(subjects))
#only use ADOS-2 if ADOS doesn't exist
subjects$useADOS.2 <- ifelse(is.na(subjects$ADOS_Total_Score), 1, 0)
subjects$ADOS.Total <- ifelse(subjects$useADOS.2, subjects$ADOS2_Total_Comparable_to_ADOS_Total, subjects$ADOS_Total_Score)
subjects$DOE.ADOS <- ifelse(subjects$useADOS.2, subjects$DOE_ADOS2, subjects$DOE_ADOS)
subjects$ADOS.RBB <- ifelse(subjects$useADOS.2, subjects$ADOS2_StereoBehavandRestricInterests_ComparableToADOS, subjects$ADOS_Stereotyped_Behaviors_and_Restricted_Interests_Total)
subjects$ADOS.SITotal <- ifelse(subjects$useADOS.2, subjects$ADOS2_SocialInteraction_ComparableToADOS, subjects$ADOS_Social_Interaction_Total)
subjects$ADOS.CTotal <- ifelse(subjects$useADOS.2, subjects$ADOS2_Communication_Total_ComparableToADOS, subjects$ADOS_Communication_Total)
subjects$ADOS.SCTotal <- subjects$ADOS.SITotal + subjects$ADOS.CTotal
names(subjects)
vars2keep <- c("ID", "Gender.x", "Primary_Dx", "Edinburgh_Integer_Handedness", "GAI", "AgeAtScan", "Race", "mean.FD", "max.FD", "useWISC.5")
col2keep <- match(vars2keep, names(subjects))
asdVarNames <- c("ID", "ADHD_Subtype", "SRS.Total.Raw.Score", "ADOS.Total", "ADOS.RBB", "ADOS.SITotal", "ADOS.CTotal", "ADOS.SCTotal", "ADI.A.Total..Reciprocal.Social.Interaction", "ADI.B.Verbal.Total..Communication", "ADI.C.Total..Restricted.Repetitive.Stereotyped.Behavior", "useADOS.2", "Praxis_GTI_%_Correct", "Praxis_Total_Percent_Correct")
asdCol <- match(asdVarNames, names(subjects))
sesVarNames <- c("ID","SES")
sesCol <- match(sesVarNames, names(subjects))
lessinfo <- subjects[, col2keep]
summary(lessinfo)
asdInfo <- subjects[, asdCol]
sesInfo <- subjects[, sesCol]
noMissing <- filter(lessinfo, GAI !="NA"& Primary_Dx !="ADHD" & Edinburgh_Integer_Handedness !="NA")
levels(noMissing$Primary_Dx) = c("Autism", "None")
noMissing$treat <- ifelse(noMissing$Primary_Dx=="Autism", 1, 0)
summary(noMissing)
m.out <- matchit(treat ~ mean.FD + AgeAtScan  + GAI + Gender.x + Edinburgh_Integer_Handedness, data = noMissing, method = "nearest")
plot(m.out, type = "jitter")
plot(m.out, type = "hist")
matched <- match.data(m.out)
matchedSES <- merge(matched, sesInfo, "ID")
with(matchedSES, table(Primary_Dx, Handedness))
chisq.test(matchedSES$Primary_Dx, matchedSES$Handedness)
with(matchedSES, table(Primary_Dx, Gender))
chisq.test(matchedSES$Primary_Dx, matchedSES$Gender)
with(matchedSES, table(Primary_Dx, Race))
with(matchedSES, table(Primary_Dx, Receiving.Coil))
chisq.test(matchedSES$Primary_Dx, matchedSES$Receiving.Coil)
prop.test(x=c(13, 16), n=c(81, 81), alternative = "two.sided")
tapply(matchedSES$AgeAtScan, list(matchedSES$Primary_Dx, matchedSES$Gender), median)
tapply(matchedSES$AgeAtScan, list(matchedSES$Primary_Dx), mean)
tapply(matchedSES$AgeAtScan, list(matchedSES$Primary_Dx), sd)
t.test(AgeAtScan~Primary_Dx, data = matchedSES)
#t.test(ISD~Primary.Dx, data = matchedSES)
tapply(matchedSES$GAI, list(matchedSES$Primary_Dx, matchedSES$Gender), median)
tapply(matchedSES$GAI, list(matchedSES$Primary_Dx), mean)
tapply(matchedSES$GAI, list(matchedSES$Primary_Dx), sd)
tapply(matchedSES$GAI, list(matchedSES$Primary_Dx), min)
t.test(GAI~Primary.Dx, data = matchedSES)
tapply(matchedSES$mean.FD, list(matchedSES$Primary_Dx, matchedSES$Gender), median)
tapply(matchedSES$max.FD, list(matchedSES$Primary_Dx, matchedSES$Gender), median)
tapply(matchedSES$frames, list(matchedSES$Primary_Dx, matchedSES$Gender), median)
t.test(mean.FD~Primary_Dx, data = matchedSES)
tapply(matchedSES$mean.FD, list(matchedSES$Primary_Dx), sd)
t.test(SES.Family~Primary_Dx, data = matchedSES)
tapply(matchedSES$SES.Family, list(matchedSES$Primary.Dx), sd, na.rm = TRUE)
View(subjects)
View(matched)
rm(list=ls())
write.xlsx("matched_data.xlsx",matched)
write.xlsx(matched,"matched_data.xlsx")
library("Amelia")
library("MatchIt")
library("Zelig")
library("dplyr")
library("ggplot2")
library("RColorBrewer")
library("xlsx")
library("optmatch")
library("reshape2")
library("readxl")
#Note GAI for 1560 should be 127 according to note in database
subjects <- read_excel("/home/niharika-shimona/Documents/Projects/Autism_Network/Data/forShimona_demographics_20161026.xlsx",sheet ="Query1")
motion <- read.table("/home/niharika-shimona/Documents/Projects/Autism_Network/Data/ASD_TD_DOS_289Total_motion.csv",header = TRUE, sep = ",")
WISC_params = read.table("/home/niharika-shimona/Documents/Projects/Autism_Network/Data/qry Shimona_03272017.csv",header = TRUE, sep = ",")
adi_info =read.table("/home/niharika-shimona/Documents/Projects/Autism_Network/Data/qry ShimonaADI_03292017.csv",header = TRUE, sep = ",")
#subjects <- merge(subjects, merge(motion, norm, "ID"), "ID")
subjects <- merge(subjects, motion, "ID")
subjects <- merge(subjects,WISC_params,"ID")
subjects <- merge(subjects,adi_info,"ID")
subjects <- filter(subjects, Eligibility.x == "Eligible")
subjects <- filter(subjects, ID == "408" || "435")
subjects <- filter(subjects, ID == "468" || "490")
subjects <- filter(subjects, ID ==  "825" || "947")
subjects <- filter(subjects, ID ==  "1039" || "1092")
subjects <- filter(subjects, ID ==  "825" || "947")
subjects <- filter(subjects, ID ==  "1205" || "1244")
subjects <- filter(subjects, ID ==  "1386" || "1548")
subjects <- filter(subjects, ID ==  "1556" || "1571")
subjects <- filter(subjects, ID ==  "1572" || "1602")
subjects <- filter(subjects, ID ==  "1626" || "1872")
#convert DOS numeric YYYYMMDD to character then to new Date class variable called ScanDate
subjects$DOS <- as.character(subjects$DOS)
subjects$ScanDate <- as.Date(subjects$DOS, "%Y%m%d")
str(subjects$ScanDate)
#convert factor DOB mm/dd/yyyy to new Date class variable called Bday
subjects$Bday <- as.Date(subjects$DOB, "%m/%d/%Y")
subjects$Bday[match("1980", subjects$ID)]<-c("2003-11-05")
subjects$Bday[match("1490", subjects$ID)]<-c("2005-03-26")
subjects$Bday[match("1435", subjects$ID)]<-c("2003-06-08")
subjects$Bday[match("1426", subjects$ID)]<-c("2003-07-02")
subjects$Bday[match("473", subjects$ID)]<-c("2002-08-14")
str(subjects$Bday)
#calculate AgeAtScan from ScanDate and Bday
subjects$AgeAtScan <- (subjects$ScanDate - subjects$Bday)
str(subjects$AgeAtScan)
#convert AgeAtScan from days to ~years
subjects$AgeAtScan <- as.numeric(subjects$AgeAtScan)/365
str(subjects$AgeAtScan)
#when WISC-IV completed at CARD, substitute Comprehension subtest scaled score for Info Scaled Score
#from paper scoring sheet or sometimes in Notes associated with WISC
subjects$WISC4.Info.Scaled[match("1495", subjects$ID)]<-10
subjects$WISC4.Info.Scaled[match("1496", subjects$ID)]<-11
subjects$WISC4.Info.Scaled[match("1519", subjects$ID)]<-9
#calculate sum of scaled scores that contribute to General Ability Index for subjects with WISC-IV data
GAI4colNames <- c("WISC4.Vocab.Scaled", "WISC4.Info.Scaled", "WISC4.Sim.Scaled", "WISC4.Blk.Dsn.Scaled", "WISC4.Pic.Con.Scaled", "WISC4.Matrix.Scaled")
GAI4cols <- match(GAI4colNames, names(subjects))
WISC4Melt <- melt(subjects[, c(1, GAI4cols)], id.vars=names(subjects)[1])
WISC4.ScaledSum <- summarise(group_by(WISC4Melt, ID), WISC4.ScaledSum = sum(value))
str(WISC4.ScaledSum)
WISC4.ScaledSum$WISC4.ScaledSum <- as.character(WISC4.ScaledSum$WISC4.ScaledSum)
#use wisc4GAI_lookup to convert sum of WISC-IV scaled scores to WISC-IV GAI
lookupGAI4 <- read.csv("/home/niharika-shimona/Documents/Projects/Autism_Network/Data/wisc4GAI_lookup.csv", header = TRUE, stringsAsFactors = FALSE)
WISC4.ScaledSum <- merge(WISC4.ScaledSum, lookupGAI4, "WISC4.ScaledSum")
#add WISC4.GAI to subjects data frame
subjects <- merge(subjects, WISC4.ScaledSum, "ID")
names(subjects)
#calculate sum of scaled scores that contribute to General Ability Index for subjects with WISC-V data
GAI5colNames <- c("WISC5.Blk.Dsn.Scaled", "WISC5.Sim.Scaled", "WISC5.Matrix.Scaled", "WISC5.Vocab.Scaled", "WISC5.Fig.Weigh.Scaled")
GAI5cols <- match(GAI5colNames, names(subjects))
WISC5Melt <- melt(subjects[, c(1, GAI5cols)], id.vars=names(subjects)[1])
WISC5.ScaledSum <- summarise(group_by(WISC5Melt, ID), WISC5.ScaledSum = sum(value))
str(WISC5.ScaledSum)
WISC5.ScaledSum$WISC5.ScaledSum <- as.character(WISC5.ScaledSum$WISC5.ScaledSum)
#use wisc5GAI_lookup to convert sum of WISC-5 scaled scores to WISC-5 GAI
lookupGAI5 <- read.csv("/home/niharika-shimona/Documents/Projects/Autism_Network/Data/wisc5GAI_lookup.csv", header = TRUE, stringsAsFactors = FALSE)
WISC5.ScaledSum <- merge(WISC5.ScaledSum, lookupGAI5, "WISC5.ScaledSum")
#add WISC5.GAI to subjects data frame
subjects <- merge(subjects, WISC5.ScaledSum, "ID")
names(subjects)
#only use WISC.5 if WISC.4 doesn't exist
#if have both, WISC.5 was collected at adolescent follow-up
subjects$useWISC.5 <- ifelse(is.na(subjects$WISC4.GAI), 1, 0)
subjects$GAI <- ifelse(subjects$useWISC.5==1, subjects$WISC5.GAI, subjects$WISC4.GAI)
subjects$DOE.GAI <- ifelse(subjects$useWISC.5==0, subjects$DOE.WISC.4, subjects$DOE.WISC.5)
##exclude subjects with GAI < 80
#subjects <- filter(subjects, GAI >=80)
#only use SRS-2 if SRS doesn't exist
#if have both, SRS-2 was collected at adolescent follow-up
subjects$useSRS.2 <- ifelse(is.na(subjects$bytSrsP2SocTotSrsRaw), 1, 0)
subjects$SRS.Total.Raw.Score <- ifelse(subjects$useSRS.2==0, subjects$bytSrsPSocTotSrsRaw, subjects$bytSrsP2SocTotSrsRaw)
subjects$SRS.SocAwar.Raw.Score <- ifelse(subjects$useSRS.2==0, subjects$bytSrsPSocAwarRaw, subjects$bytSrsP2SocAwarRaw)
subjects$SRS.SocCog.Raw.Score <- ifelse(subjects$useSRS.2==0, subjects$bytSrsPSocCogRaw, subjects$bytSrsP2SocCogRaw)
subjects$SRS.SocComm.Raw.Score <- ifelse(subjects$useSRS.2==0, subjects$bytSrsPSocCommRaw, subjects$bytSrsP2SocCommRaw)
subjects$SRS.SocMot.Raw.Score <- ifelse(subjects$useSRS.2==0, subjects$bytSrsPSocMotRaw, subjects$bytSrsP2SocMotRaw)
subjects$SRS.SocAutMan.Raw.Score <- subjects$bytSrsPSocAutManRaw
subjects$SRS.SocSRBI.Score <- subjects$bytSrsP2SocRestricInterRepetBehavRaw
subjects$SRS.CommInter.Score <- subjects$bytSrsP2SocCommInteractionRaw
subjects$DOE.SRS <- ifelse(subjects$useSRS.2==0, subjects$dtmDOEofSRS, subjects$dtmDOEofSrsP2)
names(subjects) <- gsub(" ","_",names(subjects))
names(subjects) <- gsub("&","and",names(subjects))
#only use ADOS-2 if ADOS doesn't exist
subjects$useADOS.2 <- ifelse(is.na(subjects$ADOS_Total_Score), 1, 0)
subjects$ADOS.Total <- ifelse(subjects$useADOS.2, subjects$ADOS2_Total_Comparable_to_ADOS_Total, subjects$ADOS_Total_Score)
subjects$DOE.ADOS <- ifelse(subjects$useADOS.2, subjects$DOE_ADOS2, subjects$DOE_ADOS)
subjects$ADOS.RBB <- ifelse(subjects$useADOS.2, subjects$ADOS2_StereoBehavandRestricInterests_ComparableToADOS, subjects$ADOS_Stereotyped_Behaviors_and_Restricted_Interests_Total)
subjects$ADOS.SITotal <- ifelse(subjects$useADOS.2, subjects$ADOS2_SocialInteraction_ComparableToADOS, subjects$ADOS_Social_Interaction_Total)
subjects$ADOS.CTotal <- ifelse(subjects$useADOS.2, subjects$ADOS2_Communication_Total_ComparableToADOS, subjects$ADOS_Communication_Total)
subjects$ADOS.SCTotal <- subjects$ADOS.SITotal + subjects$ADOS.CTotal
names(subjects)
vars2keep <- c("ID", "Gender.x", "Primary_Dx", "Edinburgh_Integer_Handedness", "GAI", "AgeAtScan", "Race", "mean.FD", "max.FD", "useWISC.5")
col2keep <- match(vars2keep, names(subjects))
asdVarNames <- c("ID", "ADHD_Subtype", "SRS.Total.Raw.Score","SRS.SocAwar.Raw.Score","SRS.SocCog.Raw.Score","SRS.SocComm.Raw.Score","SRS.SocMot.Raw.Score","SRS.SocAutMan.Raw.Score","SRS.SocSRBI.Raw.Score","SRS.CommInter.Score", "ADOS.Total", "ADOS.RBB", "ADOS.SITotal", "ADOS.CTotal", "ADOS.SCTotal", "ADI.A.Total..Reciprocal.Social.Interaction", "ADI.B.Verbal.Total..Communication", "ADI.C.Total..Restricted.Repetitive.Stereotyped.Behavior", "useADOS.2", "Praxis_GTI_%_Correct", "Praxis_Total_Percent_Correct")
asdCol <- match(asdVarNames, names(subjects))
sesVarNames <- c("ID","SES")
sesCol <- match(sesVarNames, names(subjects))
lessinfo <- subjects[, col2keep]
summary(lessinfo)
asdInfo <- subjects[, asdCol]
sesInfo <- subjects[, sesCol]
noMissing <- filter(lessinfo, GAI !="NA"& Primary_Dx !="ADHD" & Edinburgh_Integer_Handedness !="NA")
levels(noMissing$Primary_Dx) = c("Autism", "None")
noMissing$treat <- ifelse(noMissing$Primary_Dx=="Autism", 1, 0)
summary(noMissing)
m.out <- matchit(treat ~ mean.FD + AgeAtScan  + GAI + Gender.x + Edinburgh_Integer_Handedness, data = noMissing, method = "nearest")
plot(m.out, type = "jitter")
plot(m.out, type = "hist")
matched <- match.data(m.out)
write.xlsx(matched,"matched_data.xlsx",sheetName = "Sheet1")
matchedSES <- merge(matched, sesInfo, "ID")
with(matchedSES, table(Primary_Dx, Handedness))
chisq.test(matchedSES$Primary_Dx, matchedSES$Handedness)
with(matchedSES, table(Primary_Dx, Gender))
chisq.test(matchedSES$Primary_Dx, matchedSES$Gender)
with(matchedSES, table(Primary_Dx, Race))
with(matchedSES, table(Primary_Dx, Receiving.Coil))
chisq.test(matchedSES$Primary_Dx, matchedSES$Receiving.Coil)
prop.test(x=c(13, 16), n=c(81, 81), alternative = "two.sided")
tapply(matchedSES$AgeAtScan, list(matchedSES$Primary_Dx, matchedSES$Gender), median)
tapply(matchedSES$AgeAtScan, list(matchedSES$Primary_Dx), mean)
tapply(matchedSES$AgeAtScan, list(matchedSES$Primary_Dx), sd)
t.test(AgeAtScan~Primary_Dx, data = matchedSES)
#t.test(ISD~Primary.Dx, data = matchedSES)
tapply(matchedSES$GAI, list(matchedSES$Primary_Dx, matchedSES$Gender), median)
tapply(matchedSES$GAI, list(matchedSES$Primary_Dx), mean)
tapply(matchedSES$GAI, list(matchedSES$Primary_Dx), sd)
tapply(matchedSES$GAI, list(matchedSES$Primary_Dx), min)
t.test(GAI~Primary.Dx, data = matchedSES)
tapply(matchedSES$mean.FD, list(matchedSES$Primary_Dx, matchedSES$Gender), median)
tapply(matchedSES$max.FD, list(matchedSES$Primary_Dx, matchedSES$Gender), median)
tapply(matchedSES$frames, list(matchedSES$Primary_Dx, matchedSES$Gender), median)
t.test(mean.FD~Primary_Dx, data = matchedSES)
tapply(matchedSES$mean.FD, list(matchedSES$Primary_Dx), sd)
t.test(SES.Family~Primary_Dx, data = matchedSES)
tapply(matchedSES$SES.Family, list(matchedSES$Primary.Dx), sd, na.rm = TRUE)
install.packages('igraph')
rm(list=ls())
head(mtcars)
mtcars
mtcars = mtcars
View(mtcars)
mat=cor(t(mtcars[,c(1,3:6)]))
View(mat)
View(mat)
library(igraph)
# data
mtcars = mtcars
head(mtcars)
# Make a correlation matrix:
mat=cor(t(mtcars[,c(1,3:6)]))
mat[mat<0.995]=0
# Make an Igraph object from this matrix:
network=graph_from_adjacency_matrix( mat, weighted=T, mode="undirected", diag=F)
plot(network)
install.packages("R.matlab")
rm(list=ls())
library("Amelia")
library("MatchIt")
library("Zelig")
library("dplyr")
library("ggplot2")
library("RColorBrewer")
library("xlsx")
library("optmatch")
library("reshape2")
library("readxl")
#Note GAI for 1560 should be 127 according to note in database
subjects <- read_excel("/home/niharika-shimona/Documents/Projects/Autism_Network/Data/forShimona_demographics_20161026.xlsx",sheet ="Query1")
motion <- read.table("/home/niharika-shimona/Documents/Projects/Autism_Network/Data/ASD_TD_DOS_289Total_motion.csv",header = TRUE, sep = ",")
WISC_params = read.table("/home/niharika-shimona/Documents/Projects/Autism_Network/Data/qry Shimona_03272017.csv",header = TRUE, sep = ",")
adi_info =read.table("/home/niharika-shimona/Documents/Projects/Autism_Network/Data/qry ShimonaADI_03292017.csv",header = TRUE, sep = ",")
#subjects <- merge(subjects, merge(motion, norm, "ID"), "ID")
subjects <- merge(subjects, motion, "ID")
subjects <- merge(subjects,WISC_params,"ID")
subjects <- merge(subjects,adi_info,"ID")
subjects <- filter(subjects, Eligibility.x == "Eligible")
subjects <- filter(subjects, ID == "408" || "435")
subjects <- filter(subjects, ID == "468" || "490")
subjects <- filter(subjects, ID ==  "825" || "947")
subjects <- filter(subjects, ID ==  "1039" || "1092")
subjects <- filter(subjects, ID ==  "825" || "947")
subjects <- filter(subjects, ID ==  "1205" || "1244")
subjects <- filter(subjects, ID ==  "1386" || "1548")
subjects <- filter(subjects, ID ==  "1556" || "1571")
subjects <- filter(subjects, ID ==  "1572" || "1602")
subjects <- filter(subjects, ID ==  "1626" || "1872")
#convert DOS numeric YYYYMMDD to character then to new Date class variable called ScanDate
subjects$DOS <- as.character(subjects$DOS)
subjects$ScanDate <- as.Date(subjects$DOS, "%Y%m%d")
str(subjects$ScanDate)
#convert factor DOB mm/dd/yyyy to new Date class variable called Bday
subjects$Bday <- as.Date(subjects$DOB, "%m/%d/%Y")
subjects$Bday[match("1980", subjects$ID)]<-c("2003-11-05")
subjects$Bday[match("1490", subjects$ID)]<-c("2005-03-26")
subjects$Bday[match("1435", subjects$ID)]<-c("2003-06-08")
subjects$Bday[match("1426", subjects$ID)]<-c("2003-07-02")
subjects$Bday[match("473", subjects$ID)]<-c("2002-08-14")
str(subjects$Bday)
#calculate AgeAtScan from ScanDate and Bday
subjects$AgeAtScan <- (subjects$ScanDate - subjects$Bday)
str(subjects$AgeAtScan)
#convert AgeAtScan from days to ~years
subjects$AgeAtScan <- as.numeric(subjects$AgeAtScan)/365
str(subjects$AgeAtScan)
#when WISC-IV completed at CARD, substitute Comprehension subtest scaled score for Info Scaled Score
#from paper scoring sheet or sometimes in Notes associated with WISC
subjects$WISC4.Info.Scaled[match("1495", subjects$ID)]<-10
subjects$WISC4.Info.Scaled[match("1496", subjects$ID)]<-11
subjects$WISC4.Info.Scaled[match("1519", subjects$ID)]<-9
#calculate sum of scaled scores that contribute to General Ability Index for subjects with WISC-IV data
GAI4colNames <- c("WISC4.Vocab.Scaled", "WISC4.Info.Scaled", "WISC4.Sim.Scaled", "WISC4.Blk.Dsn.Scaled", "WISC4.Pic.Con.Scaled", "WISC4.Matrix.Scaled")
GAI4cols <- match(GAI4colNames, names(subjects))
WISC4Melt <- melt(subjects[, c(1, GAI4cols)], id.vars=names(subjects)[1])
WISC4.ScaledSum <- summarise(group_by(WISC4Melt, ID), WISC4.ScaledSum = sum(value))
str(WISC4.ScaledSum)
WISC4.ScaledSum$WISC4.ScaledSum <- as.character(WISC4.ScaledSum$WISC4.ScaledSum)
#use wisc4GAI_lookup to convert sum of WISC-IV scaled scores to WISC-IV GAI
lookupGAI4 <- read.csv("/home/niharika-shimona/Documents/Projects/Autism_Network/Data/wisc4GAI_lookup.csv", header = TRUE, stringsAsFactors = FALSE)
WISC4.ScaledSum <- merge(WISC4.ScaledSum, lookupGAI4, "WISC4.ScaledSum")
#add WISC4.GAI to subjects data frame
subjects <- merge(subjects, WISC4.ScaledSum, "ID")
names(subjects)
#calculate sum of scaled scores that contribute to General Ability Index for subjects with WISC-V data
GAI5colNames <- c("WISC5.Blk.Dsn.Scaled", "WISC5.Sim.Scaled", "WISC5.Matrix.Scaled", "WISC5.Vocab.Scaled", "WISC5.Fig.Weigh.Scaled")
GAI5cols <- match(GAI5colNames, names(subjects))
WISC5Melt <- melt(subjects[, c(1, GAI5cols)], id.vars=names(subjects)[1])
WISC5.ScaledSum <- summarise(group_by(WISC5Melt, ID), WISC5.ScaledSum = sum(value))
str(WISC5.ScaledSum)
WISC5.ScaledSum$WISC5.ScaledSum <- as.character(WISC5.ScaledSum$WISC5.ScaledSum)
#use wisc5GAI_lookup to convert sum of WISC-5 scaled scores to WISC-5 GAI
lookupGAI5 <- read.csv("/home/niharika-shimona/Documents/Projects/Autism_Network/Data/wisc5GAI_lookup.csv", header = TRUE, stringsAsFactors = FALSE)
WISC5.ScaledSum <- merge(WISC5.ScaledSum, lookupGAI5, "WISC5.ScaledSum")
#add WISC5.GAI to subjects data frame
subjects <- merge(subjects, WISC5.ScaledSum, "ID")
names(subjects)
#only use WISC.5 if WISC.4 doesn't exist
#if have both, WISC.5 was collected at adolescent follow-up
subjects$useWISC.5 <- ifelse(is.na(subjects$WISC4.GAI), 1, 0)
subjects$GAI <- ifelse(subjects$useWISC.5==1, subjects$WISC5.GAI, subjects$WISC4.GAI)
subjects$DOE.GAI <- ifelse(subjects$useWISC.5==0, subjects$DOE.WISC.4, subjects$DOE.WISC.5)
##exclude subjects with GAI < 80
#subjects <- filter(subjects, GAI >=80)
#only use SRS-2 if SRS doesn't exist
#if have both, SRS-2 was collected at adolescent follow-up
subjects$useSRS.2 <- ifelse(is.na(subjects$bytSrsP2SocTotSrsRaw), 1, 0)
subjects$SRS.Total.Raw.Score <- ifelse(subjects$useSRS.2==0, subjects$bytSrsPSocTotSrsRaw, subjects$bytSrsP2SocTotSrsRaw)
subjects$SRS.SocAwar.Raw.Score <- ifelse(subjects$useSRS.2==0, subjects$bytSrsPSocAwarRaw, subjects$bytSrsP2SocAwarRaw)
subjects$SRS.SocCog.Raw.Score <- ifelse(subjects$useSRS.2==0, subjects$bytSrsPSocCogRaw, subjects$bytSrsP2SocCogRaw)
subjects$SRS.SocComm.Raw.Score <- ifelse(subjects$useSRS.2==0, subjects$bytSrsPSocCommRaw, subjects$bytSrsP2SocCommRaw)
subjects$SRS.SocMot.Raw.Score <- ifelse(subjects$useSRS.2==0, subjects$bytSrsPSocMotRaw, subjects$bytSrsP2SocMotRaw)
subjects$SRS.SocAutMan.Raw.Score <- subjects$bytSrsPSocAutManRaw
subjects$SRS.SocSRBI.Score <- subjects$bytSrsP2SocRestricInterRepetBehavRaw
subjects$SRS.CommInter.Score <- subjects$bytSrsP2SocCommInteractionRaw
subjects$DOE.SRS <- ifelse(subjects$useSRS.2==0, subjects$dtmDOEofSRS, subjects$dtmDOEofSrsP2)
names(subjects) <- gsub(" ","_",names(subjects))
names(subjects) <- gsub("&","and",names(subjects))
#only use ADOS-2 if ADOS doesn't exist
subjects$useADOS.2 <- ifelse(is.na(subjects$ADOS_Total_Score), 1, 0)
subjects$ADOS.Total <- ifelse(subjects$useADOS.2, subjects$ADOS2_Total_Comparable_to_ADOS_Total, subjects$ADOS_Total_Score)
subjects$DOE.ADOS <- ifelse(subjects$useADOS.2, subjects$DOE_ADOS2, subjects$DOE_ADOS)
subjects$ADOS.RBB <- ifelse(subjects$useADOS.2, subjects$ADOS2_StereoBehavandRestricInterests_ComparableToADOS, subjects$ADOS_Stereotyped_Behaviors_and_Restricted_Interests_Total)
subjects$ADOS.SITotal <- ifelse(subjects$useADOS.2, subjects$ADOS2_SocialInteraction_ComparableToADOS, subjects$ADOS_Social_Interaction_Total)
subjects$ADOS.CTotal <- ifelse(subjects$useADOS.2, subjects$ADOS2_Communication_Total_ComparableToADOS, subjects$ADOS_Communication_Total)
subjects$ADOS.SCTotal <- subjects$ADOS.SITotal + subjects$ADOS.CTotal
names(subjects)
vars2keep <- c("ID", "Gender.x", "Primary_Dx", "Edinburgh_Integer_Handedness", "GAI", "AgeAtScan", "Race", "mean.FD", "max.FD", "useWISC.5")
col2keep <- match(vars2keep, names(subjects))
asdVarNames <- c("ID", "ADHD_Subtype", "SRS.Total.Raw.Score","SRS.SocAwar.Raw.Score","SRS.SocCog.Raw.Score","SRS.SocComm.Raw.Score","SRS.SocMot.Raw.Score","SRS.SocAutMan.Raw.Score","SRS.SocSRBI.Raw.Score","SRS.CommInter.Score", "ADOS.Total", "ADOS.RBB", "ADOS.SITotal", "ADOS.CTotal", "ADOS.SCTotal", "ADI.A.Total..Reciprocal.Social.Interaction", "ADI.B.Verbal.Total..Communication", "ADI.C.Total..Restricted.Repetitive.Stereotyped.Behavior", "useADOS.2", "Praxis_GTI_%_Correct", "Praxis_Total_Percent_Correct")
asdCol <- match(asdVarNames, names(subjects))
sesVarNames <- c("ID","SES")
sesCol <- match(sesVarNames, names(subjects))
lessinfo <- subjects[, col2keep]
summary(lessinfo)
asdInfo <- subjects[, asdCol]
sesInfo <- subjects[, sesCol]
noMissing <- filter(lessinfo, GAI !="NA"& Primary_Dx !="ADHD" & Edinburgh_Integer_Handedness !="NA")
levels(noMissing$Primary_Dx) = c("Autism", "None")
noMissing$treat <- ifelse(noMissing$Primary_Dx=="Autism", 1, 0)
summary(noMissing)
m.out <- matchit(treat ~ mean.FD + AgeAtScan  + GAI + Gender.x + Edinburgh_Integer_Handedness, data = noMissing, method = "nearest")
plot(m.out, type = "jitter")
plot(m.out, type = "hist")
matched <- match.data(m.out)
write.xlsx(matched,"matched_data.xlsx",sheetName = "Sheet1")
match.data(m.out)
matched <- noMissing(m.out)
